---
title: "aula03_exercicio1"
output: html_document
date: "2024-06-07"
---

"```{r}
library(dplyr)
library(lubridate)
```"

```{r}
install.packages('lubridate')
```

```{r}
library(tidyverse)

```

```{r}
car_chash <- read.csv('/home/espinf/asmesquita/repos/DSBD/linguagem-de-programacao/Brazil Total highway crashes 2010 - 2023.csv')

dados1 <- car_chash %>%
  summarise(total_automoveis = sum(automovel, na.rm = TRUE))
car_chash
```

```{r}
dados2 <- car_chash %>%
  mutate(ano = year(dmy(data))) %>%
  group_by(ano) %>%
  summarise(total_automoveis = sum(automovel, na.rm = TRUE),
            total_mortos = sum(mortos, na.rm = TRUE))
dados2
```

```{r}
car_chash1 <- car_chash %>%
  filter(tipo_de_ocorrencia == 'com vítima') %>%
  summarise(total_automoveis = sum(automovel, na.rm = TRUE),
            total_mortos = sum(mortos, na.rm = TRUE))
car_chash1
```

# Exercícios

### Utilizando o banco de dados starwars, faça o que se pede:

```{r}
starwars
```

1)  Qual é o número total de espécies únicas presentes? Qual a frequência de indivíduos por espécie?

```{r}
starwars %>%
  summarise(distinct_species = n_distinct(species))
```

```{r}
starwars %>%
  group_by(species) %>%
  summarize(total = n_distinct(name)) %>%
  arrange(desc(total))
```

2)  Calcule a altura média de personagens masculinos e femininos

```{r}
starwars %>%
  filter(sex %in% c('female','male')) %>% 
  group_by(sex) %>%
  summarise(media = mean(height, na.rm = TRUE))
```

3)  Qual é o peso médio dos personagens de cada espécie para personagens masculinos?

```{r}
starwars %>%
  filter(sex %in% c('male')) %>%
  summarise(peso_medio = mean(mass, na.rm = TRUE))
```

4)  Para cada espécie presente na base de dados, identifique o personagem mais pesado e seu peso correspondente.

```{r}
starwars %>%
  group_by(species) %>%
  filter(mass == max(mass, na.rm = TRUE)) %>%
  select(species,name,mass)
```

# Exercícios

### Utilizando o banco de dados car_crash faça o que se pede:

```{r}
car_chash <- read.csv('/home/espinf/asmesquita/repos/DSBD/linguagem-de-programacao/Brazil Total highway crashes 2010 - 2023.csv')

car_chash
```

1)  Quais os meses do ano com maior número de acidentes fatais?

```{r}
car_chash %>%
  mutate(ano = year(dmy(data))) %>%
  group_by(ano) %>%
  summarise(total = sum(mortos,na.rm = TRUE)) %>%
  arrange(desc(total))
```

2)  Quais os dias da semana com maior número de acidentes fatais?

```{r}
car_chash %>%
  mutate(data = dmy(data)) %>%
  mutate(dia_semana = lubridate::wday(data, label= T, abbr=F)) %>%
  select(dia_semana, mortos) %>%
  filter(mortos > 0) %>%
  group_by(dia_semana) %>%
  summarise(total_mortos_dia = sum(mortos, na.rm = TRUE)) %>%
  arrange(desc(total_mortos_dia))
```

# Exercícios

### Utilize os dados do pacote nycflights13 para responder as perguntas abaixo:

```{r}
library(nycflights13)
flights
```

```{r}
weather
```

1.  Para vôos com atraso superior a 12 horas em flights, verifique ascondições climáticas em weather. Quais os meses do ano em que vocêencontra o maior número de atrasos?

```{r}
flights %>% 
  filter(arr_delay > 12*60 | dep_delay > 12*60) %>% 
  inner_join(weather, by=c('year','month','day','hour','origin')) %>% 
  group_by(month) %>% 
  summarize(
    total_atrasos = n(),
    mean_temp = mean(temp, na.rm = T),
    mean_dewp = mean(dewp, na.rm = T),
    mean_humid = mean(humid, na.rm = T),
    mean_wind_speed = mean(wind_speed, na.rm = T),
    mean_precip = mean(precip, na.rm = T)
  ) %>% 
  arrange(desc(total_atrasos))
```

2.  Encontre os 20 destinos mais comuns e identifique seu aeroporto.

```{r}
flights %>% 
  group_by(dest) %>% 
  summarize(total = n()) %>% 
  arrange(desc(total)) %>% 
  inner_join(airports, by = c('dest'='faa')) %>% 
  select(dest, name, total)
```

3.  Inclua uma coluna com a cia aérea na tabela planes. Quantas companhias áreas voaram cada avião naquele ano?

```{r}
flights %>% 
  inner_join(planes, by='tailnum') %>% 
  group_by(tailnum, carrier) %>% 
  summarize(total_voos = n()) %>% 
  arrange(desc(total_voos))
```

4.  Inclua a latitude e longitude de cada origem destino na tabela flights.

```{r}
flights %>% 
  inner_join(airports, by = c('origin' = 'faa')) %>% 
  inner_join(airports, by = c('dest' = 'faa')) %>% 
  select(origin, dest, lat.x, lon.x, lat.y, lon.y)
```

## Exercícios

# 1. Utilizando os dados de flights, crie uma matriz que mostra o número

de voos entre cada par de aeroportos.

```{r}

library(tidyr)
flights %>% 
  count(origin, dest) %>% 
  pivot_wider(names_from = origin,
              values_from = n,
              values_fill = 0)
```
